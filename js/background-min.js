var keuneksen={isPlaying:"no",elCss:"#player",startupVolume:70,nowPlaying:{url:"http://live.radioeksen.com/live/nowplaying/RadioEksen",defaultMessages:["RADYO EKSEN -","REKLAM","REKLAM-REKLAM"],interval:5000},stream:{title:"Radyo Eksen",m4a:"http://eksenwmp.radyotvonline.com:80/;"}};chrome.browserAction.setIcon({path:"../icon.png"});$(function(){var a=$(keuneksen.elCss),b=false;keuneksen.el=a;a.jPlayer({ready:function(c){b=true;a.jPlayer("setMedia",keuneksen.stream)},pause:function(){a.jPlayer("clearMedia")},error:function(c){if(b&&c.jPlayer.error.type===$.jPlayer.error.URL_NOT_SET){a.jPlayer("setMedia",keuneksen.stream).jPlayer("play")}},swfPath:"js/lib/",supplied:"m4a",preload:"none",wmode:"window"})});function capitalizeFirst(a){return a.replace(/\b-\b/g," - ").replace(/\w\S*/g,function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()})}chrome.extension.onMessage.addListener(function(e,b,a){var d=localStorage.getItem("keuneksen");if(d){d=JSON.parse(d)}else{d={volume:keuneksen.startupVolume}}if(e.type==="set"){if(e.volume){keuneksen.el.jPlayer("volume",(e.volume/100));d.volume=e.volume}else{var c=keuneksen.startupVolume;if(d.volume){c=d.volume}keuneksen.el.jPlayer("volume",(c/100))}if(e.isPlaying){if(e.isPlaying==="yes"){keuneksen.el.jPlayer("play");keuneksen.isPlaying="yes";keuneksen.setTexts();chrome.browserAction.setIcon({path:"../icon-play.png"})}else{keuneksen.el.jPlayer("stop");keuneksen.isPlaying="no";chrome.browserAction.setIcon({path:"../icon.png"})}}d=JSON.stringify(d);localStorage.setItem("keuneksen",d);return true}else{if(e.type==="query"){a(d);return true}}});(function setTexts(){clearTimeout(keuneksen.scheduledExecution);if(keuneksen.isPlaying==="yes"){$.ajax(keuneksen.nowPlaying.url,{timeout:keuneksen.nowPlaying.interval,success:function(b){if($.inArray(b.trim(),keuneksen.nowPlaying.defaultMessages)===-1){var c=$("<div></div>").html(b);c.find("span, br").remove();var a=capitalizeFirst(c.text().trim());a=a.replace(/ -$/,"");if(chrome.extension.getViews({type:"popup"}).length){chrome.extension.sendMessage({nowPlaying:a},function(){})}chrome.browserAction.getTitle({},function(d){if(d!==a){chrome.browserAction.setTitle({title:a})}})}}})}else{chrome.browserAction.setTitle({title:""})}keuneksen.setTexts=setTexts;keuneksen.scheduledExecution=setTimeout(setTexts,keuneksen.nowPlaying.interval)})();